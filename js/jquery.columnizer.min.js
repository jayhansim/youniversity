!function($){$.fn.columnize=function(t){function e(t,e){try{t.append(e)}catch(i){t[0].appendChild(e[0])}}this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var i={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,cssClassPrefix:"",elipsisText:"...",debug:0};return t=$.extend(i,t),"string"==typeof t.width&&(t.width=parseInt(t.width,10),isNaN(t.width)&&(t.width=i.width)),"function"==typeof t.setColumnStart&&(this.setColumnStart=t.setColumnStart),"string"==typeof t.elipsisText&&(this.elipsisText=t.elipsisText),t.debug&&(this.debug=t.debug),t.setWidth||(t.setWidth=t.precise?function(t){return 100/t}:function(t){return Math.floor(100/t)}),this.each(function(){function s(t,e){var i=e?".":"";return m.length?i+m+"-"+t:i+t}function n(i,n,l,o){for(;(g||l.height()<o)&&n[0].childNodes.length;){var r=n[0].childNodes[0];if($(r).find(s("columnbreak",!0)).length)return;if($(r).hasClass(s("columnbreak")))return;e(i,$(r))}if(0!==i[0].childNodes.length){var a=i[0].childNodes,h=a[a.length-1];i[0].removeChild(h);var d=$(h);if(3==d[0].nodeType){var f=d[0].nodeValue,c=t.width/18;t.accuracy&&(c=t.accuracy);for(var u,m=null;l.height()<o&&f.length;){var v=f.indexOf(" ",c);u=-1!=v?f.substring(0,v):f,m=document.createTextNode(u),e(i,$(m)),f=f.length>c&&-1!=v?f.substring(v):""}if(l.height()>=o&&null!==m&&(i[0].removeChild(m),f=m.nodeValue+f),!f.length)return!1;d[0].nodeValue=f}return n.contents().length?n.prepend(d):e(n,d),3==d[0].nodeType}}function l(t,i,o,r){if(!t.contents(":last").find(s("columnbreak",!0)).length&&!t.contents(":last").hasClass(s("columnbreak"))&&i.contents().length){var a=i.contents(":first");if("undefined"==typeof a.get(0)||1!=a.get(0).nodeType)return;var h=a.clone(!0);if(a.hasClass(s("columnbreak")))e(t,h),a.remove();else if(g)e(t,h),a.remove();else if(1==h.get(0).nodeType&&!h.hasClass(s("dontend")))if(e(t,h),h.is("img")&&o.height()<r+20)a.remove();else if(a.hasClass(s("dontsplit"))&&o.height()<r+20)a.remove();else if(h.is("img")||a.hasClass(s("dontsplit")))h.remove();else{if(h.empty(),n(h,a,o,r))a.addClass(s("split"));else{if(a.addClass(s("split")),"OL"==a.get(0).tagName){var d=h.get(0).childElementCount+h.get(0).start;a.attr("start",d+1)}a.children().length&&l(h,a,o,r)}0===h.get(0).childNodes.length&&(h.remove(),a.removeClass(s("split")))}}}function o(){if(!h.data("columnized")||1!=h.children().length){if(h.data("columnized",!0),h.data("columnizing",!0),h.empty(),h.append($("<div class='"+s("first")+" "+s("last")+" "+s("column")+" ' style='width:100%; float: "+t.columnFloat+";'></div>")),$col=h.children().eq(h.children().length-1),$destroyable=f.clone(!0),t.overflow){for(targetHeight=t.overflow.height,n($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(s("dontend"))||l($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&r($col.contents(":last").get(0));){var i=$col.contents(":last");i.remove(),$destroyable.prepend(i)}for(var o="",a=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var d=$destroyable[0].childNodes[0];if(d.attributes)for(var c=0;c<d.attributes.length;c++)0===d.attributes[c].nodeName.indexOf("jQuery")&&d.removeAttribute(d.attributes[c].nodeName);a.innerHTML="",a.appendChild($destroyable[0].childNodes[0]),o+=a.innerHTML}var u=$(t.overflow.id)[0];u.innerHTML=o}else e($col,$destroyable.contents());h.data("columnizing",!1),t.overflow&&t.overflow.doneFunc&&t.overflow.doneFunc(),t.doneFunc()}}function r(t){return 3==t.nodeType?/^\s+$/.test(t.nodeValue)&&t.previousSibling?r(t.previousSibling):!1:1!=t.nodeType?!1:$(t).hasClass(s("dontend"))?!0:0===t.childNodes.length?!1:r(t.childNodes[t.childNodes.length-1])}function a(){if(v=0,c!=h.width()){c=h.width();var i=Math.round(h.width()/t.width),a=t.width,u=t.height;if(t.columns&&(i=t.columns),g&&(i=f.find(s("columnbreak",!0)).length+1,a=!1),1>=i)return o();if(!h.data("columnizing")){h.data("columnized",!0),h.data("columnizing",!0),h.empty(),h.append($("<div style='width:"+t.setWidth(i)+"%; float: "+t.columnFloat+";'></div>")),N=h.children(":last"),e(N,f.clone()),d=N.height(),h.empty();var m=d/i,p=!0,b=3,y=!1;t.overflow?(b=1,m=t.overflow.height):u&&a&&(b=1,m=u,y=!0);for(var w=0;b>w&&20>w;w++){h.empty();var x,C,N,T;try{x=f.clone(!0)}catch(L){x=f.clone()}x.css("visibility","hidden");for(var M=0;i>M;M++)C=0===M?s("first"):"",C+=" "+s("column"),C=M==i-1?s("last")+" "+C:C,h.append($("<div class='"+C+"' style='width:"+t.setWidth(i)+"%; float: "+t.columnFloat+";'></div>"));for(M=0;M<i-(t.overflow?0:1)||y&&x.contents().length;){for(h.children().length<=M&&h.append($("<div class='"+C+"' style='width:"+t.setWidth(i)+"%; float: "+t.columnFloat+";'></div>")),N=h.children().eq(M),y&&N.width(a+"px"),n(N,x,N,m),l(N,x,N,m);N.contents(":last").length&&r(N.contents(":last").get(0));)T=N.contents(":last"),T.remove(),x.prepend(T);M++,0===N.contents().length&&x.contents().length?N.append(x.contents(":first")):M!=i-(t.overflow?0:1)||t.overflow||x.find(s("columnbreak",!0)).length&&i++}if(t.overflow&&!y){var O=!1,S=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(O||S){for(var k="",F=document.createElement("DIV");x[0].childNodes.length>0;){var z=x[0].childNodes[0];for(M=0;M<z.attributes.length;M++)0===z.attributes[M].nodeName.indexOf("jQuery")&&z.removeAttribute(z.attributes[M].nodeName);F.innerHTML="",F.appendChild(x[0].childNodes[0]),k+=F.innerHTML}var H=$(t.overflow.id)[0];H.innerHTML=k}else $(t.overflow.id).empty().append(x.contents().clone(!0))}else if(y)h.children().each(function(t){N=h.children().eq(t),N.width(a+"px"),0===t?N.addClass(s("first")):t==h.children().length-1?N.addClass(s("last")):(N.removeClass(s("first")),N.removeClass(s("last")))}),h.width(h.children().length*a+"px");else{N=h.children().eq(h.children().length-1),x.contents().each(function(){N.append($(this))});var I=N.height(),V=I-m,q=0,B=1e7,P=0,W=!1,E=0;h.children().each(function(t){return function(e){var i=t.children().eq(e),n=i.children(":last").find(s("columnbreak",!0)).length;if(!n){var l=i.height();W=!1,q+=l,l>P&&(P=l,W=!0),B>l&&(B=l),E++}}}(h));var j=q/E;0===q?w=b:t.lastNeverTallest&&W?(v+=5,m+=30,w==b-1&&b++):P-B>30?m=j+30:Math.abs(j-m)>20?m=j:w=b}h.append($("<br style='clear:both;'>"))}h.find(s("column",!0)).find(":first"+s("removeiffirst",!0)).remove(),h.find(s("column",!0)).find(":last"+s("removeiflast",!0)).remove(),h.find(s("split",!0)).find(":first"+s("removeiffirst",!0)).remove(),h.find(s("split",!0)).find(":last"+s("removeiflast",!0)).remove(),h.data("columnizing",!1),t.overflow&&t.overflow.doneFunc(),t.doneFunc()}}}var h=$(t.target?t.target:this),d=$(this).height(),f=$("<div></div>"),c=0,u=!1,g=t.manualBreaks,m=i.cssClassPrefix;"string"==typeof t.cssClassPrefix&&(m=t.cssClassPrefix);var v=0;if(e(f,$(this).contents().clone(!0)),!t.ignoreImageLoading&&!t.target&&!h.data("imageLoaded")&&(h.data("imageLoaded",!0),$(this).find("img").length>0)){var p=function(i,s){return function(){i.data("firstImageLoaded")||(i.data("firstImageLoaded","true"),e(i.empty(),s.children().clone(!0)),i.columnize(t))}}($(this),f);return $(this).find("img").one("load",p),void $(this).find("img").one("abort",p)}h.empty(),a(),t.buildOnce||$(window).resize(function(){t.buildOnce||(h.data("timeout")&&clearTimeout(h.data("timeout")),h.data("timeout",setTimeout(a,200)))})})},$.fn.renumberByJS=function(t,e,i,s){if(this.setList=function(t,e,i){var s=this.before.parents(),n;if(n=$(t[this.offset-1]).find(">*"),n.last()[0].tagName!=i.toUpperCase())return this.debug&&console.log("Last item in previous column, isn't a list..."),0;n=n.length;var l=1;if(l=this.lastOther<=0?this.before.children().length+1:$(s[this.lastOther]).children().length+1,$(t[this.offset]).find(i+":first li.split").length){var o=$(t[this.offset-1]).find(i+":last li:last");if(""===this.elipsisText||$(t[this.offset-1]).find(i+":last ~ div").length||$(t[this.offset-1]).find(i+":last ~ p").length);else if(0==$(o).find("ul, ol, dl").length){var r=o.last().text(),a=r.length;";"==r.substring(a-1)?r.substring(a-4)!=this.elipsisText+";"&&(r=r.substring(0,a-1)+this.elipsisText+";"):r.substring(a-3)!=this.elipsisText&&(r+=this.elipsisText),o.last().text(r)}0==$(t[this.offset]).find(i+":first >li.split >"+i).length&&l--}if(1==n&&(l+=this.prevMax),this.nest>1){this.debug&&console.log("Supposed to be a nested list...decr"),l--;var h=$(t[this.offset-1]).find(i+":first li.split:first");h.length>0&&(this.debug&&console.log("Previous column started with a split item, so that count is one less than expected"),l--),h=$(t[this.offset]).find(i+":first li:first").clone(),h.children().remove(),$.trim(h.text()).length>0&&(this.debug&&console.log("If that was a complete list in the previous column, don't decr."),l++,0==$(t[this.offset-1]).find(">"+i+":last ").children().length&&(this.debug&&console.log("unless that was empty, in which case revert"),l--))}else{var h=$(t[this.offset]).find(i+":first li:first "+i+".split li.split");h.length>0&&(this.debug&&console.log("[Nested] Column started with a split item, so that count is one less than expected"),l--)}return this.debug&&console.log("Setting the start value to "+l+" ("+this.prevMax+")"),l>0&&("function"==typeof this.setColumnStart?this.setColumnStart(e,l):e.attr("start",l)),0},"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=!1),!i&&!s)throw"renumberByJS(): Bad param, must pass an id or a class";var n="";this.prevMax=1,n=s?"."+s:"#"+i;var l=t.toLowerCase(),o=t.toUpperCase();for(this.cols=$(n),this.debug&&console.log("There are "+this.cols.length+" items, looking for "+l),this.before=$(this.cols[0]).find(l+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug&&console.log("iterating "+this.offset+"...[of "+this.cols.length+"]"),this.offset%e!=0){if(this.before=$(this.cols[this.offset-1]).find(l+":last"),this.before.length){this.debug&&console.log("Have some "+t+" elements in the previous column");var r=$(this.cols[this.offset]).find(l+":first"),a=$(this.cols[this.offset]).find("*:first");if(a[0]!==r[0])continue;var h=this.before.parents();this.lastOther=0;for(var d=!1;this.lastOther<h.length;this.lastOther++)if(h[this.lastOther].tagName!=o&&"LI"!=h[this.lastOther].tagName){d=!0,this.lastOther--;break}this.nest=1,$(this.cols[this.offset]).find(">"+l+":first li "+l+":first").length&&(this.nest=2),this.setList(this.cols,r,l),this.lastOther--,r=$(this.cols[this.offset]).find(l+":first li "+l+":first"),r.length&&(this.before=$(this.cols[this.offset-1]).find(">"+l+":last li "+l+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,r,l));var f=$(this.cols[this.offset-1]).find(">"+l+":last");this.prevMax=f.children().length}}else this.debug&&console.log("First column (in theory..)"),this.prevMax=1;return 0}}(jQuery);